---
title: "Introduction aux bases de donn√©es relationnelles"
subtitle: "Master Hydrosyst√®mes et Bassins Versants"
author: "Louis Mani√®re"
institute: "Universit√© de Tours"
date: last-modified
license: "code : MIT License, presentation : CC BY-NC"
lang: "fr"
format: 
  revealjs:
    transition: slide
    background-transition: fade
    navigation-mode: vertical
    theme: custom.scss
    logo: "./img/universite-tours-logo.png"
    footer: "Master 2 Hydrosyst√®mes et Bassins Versants 2024-2025"
    css: custom.css
    slide-number: true
    show-slide-number: all
    smaller: false
    chalkboard: true
    margin: 0.2
    width: 1150
    df-print: kable
editor: visual
---

# Introduction aux base de donn√©es et au langage SQL


## Une base de donn√©es, c'est quoi ?

\

::: columns
::: {.column width="50%"}

- Un ensemble de qui va permettre de structurer et de stocker des donn√©es :
  - des donn√©es
  - un syst√®me de gestion de base de donn√©es (SGBD)

:::
::: {.column width="50%"}

![](./img/database_intro.jpg) [^1]

:::
:::

[^1]: ["Original Database"](https://www.flickr.com/photos/8052628@N05/3835365695) by [shindoverse](https://www.flickr.com/photos/8052628@N05) is licensed under [CC BY-NC-SA 2.0](https://creativecommons.org/licenses/by-nc-sa/2.0/?ref=openverse).

## Un SGBD ? ü§î

- Un logiciel qui permet de stocker, de manipuler et de r√©cup√©rer des donn√©es.
- Il existe plusieurs types de SGBD :
  - relationnels
  - NoSQL
  - objets
  - etc.
  
## Les logiciels de SGBD relationnels

::: columns
::: {.column width="50%"}
![](./img/postgresql.png){width="30%"}

![](./img/postgis.png){width="30%"}

\

![](./img/mysql.png){width="45%"}
:::

::: {.column width="50%"}
![](./img/sqlite.png){width="60%"}

![](./img/spatialite.png){width="40%"}

\
\

![](./img/oracle.png){width="45%"}
:::
:::

## Les bases de donn√©es relationnelles

- Les donn√©es sont stock√©es dans des tables
- Les tables sont reli√©es entre elles par des cl√©s

Objectifs :

- Eviter la redondance d'information
- Eviter les incoh√©rences
- Faciliter la mise √† jour des donn√©es
- Faciliter la recherche d'information

## Une architecture client-serveur

- Un serveur qui h√©berge la base de donn√©es
- Des clients qui se connectent au serveur pour interagir avec la base de donn√©es
  - Connexion au serveur par le nom de l'h√¥te, le port, le nom de la base de donn√©es, le nom d'utilisateur et le mot de passe
  - Interface graphique (pgAdmin4, DBeaver, QGIS)
  - Ligne de commande (psql)

## Cl√©s primaires et cl√©s √©trang√®res

- Cl√© primaire : identifiant unique d'une ligne
- Cl√© √©trang√®re : identifiant d'une ligne d'une autre table

- Type de relation (cardinalit√©) :
  - 1-1 : 1 ligne table 1 = 1 ligne table 2
  - 1-n : 1 ligne table 1 = n lignes table 2
  - n-n : n lignes table 1 = n lignes table 2

## Construisons une base de donn√©es

- Cours d'eau
- Bassins versants
- Stations de mesures
- Site de travaux
- Inventaire d'esp√®ces

## Mod√®le conceptuel de donn√©es (MCD)

![](./img/bd_cours_eau.webp)

## Le SQL (Structured Query Langage)

- Proche du langage naturel
- Le langage permettant d'int√©ragir avec une base de donn√©es
  - Langage de d√©finition des donn√©es (LDD) = cr√©ation d'une table
  - Langage de manipulation des donn√©es (LMD) = ajout, mise √† jour, suppression ou lecture de lignes
  - Langage de contr√¥le de donn√©es (LCD) = j'autorise Maurice √† consulter ces tables mais pas √† les modifier

## Principales instructions SQL {.smaller}

\

::: columns
::: {.column width="50%"}

- D√©finition
  - CREATE = cr√©ation d'une table
  - DROP = suppression d'une table
  - ALTER = modification d'une table
- Mise √† jour et lecture de ligne
  - INSERT = ajout
  - DELETE = suppression
  - UPDATE = mise √† jour
  - SELECT = consultation
  
:::
::: {.column width="50%"}

- Contr√¥le d'autorisation d'acc√®s
  - GRANT = affectaction de droits
  - REVOKE = suppression de droits
- Gestion de transaction
  - COMMIT = validation de modifications
  - ROLLBACK = annulation de modifications

:::
:::

## Les SELECT

```sql
SELECT nom, longueur --champs/colonnes
FROM cours_eau --table
WHERE longueur > 5; --conditions/filtres
```

\

En fran√ßais : **S√©lectionne** les champs *nom* et *longueur* **depuis** la table *cours_eau* **o√π** les valeurs du champ *longueur > 5*.

\

Exemple plus complet
```sql
SELECT colonne1, colonne2 --champs/colonnes
FROM table --table
WHERE colonne2 > x --conditions/filtres
GROUP BY colonne1 --aggr√©gation
HAVING count(colonne1) > y --filtre sur l'aggr√©gation
ORDER BY colonne1 ASC --tri
LIMIT 10; --limite le nombre de r√©sultats
```

## Les jointures

![](./img/jointures.png){width="100%"}

## Exemple de jointure

```sql
SELECT cours_eau.nom, bassin_versant.nom
FROM cours_eau
INNER JOIN bassin_versant  --jointure avec la table bassin_versant
  ON cours_eau.id_bassin = bassin_versant.id; --cl√©s de jointure
```

\

On s√©lectionne le nom du cours d'eau et le nom du bassin versant **depuis** la table *cours_eau* **en joignant** la table *bassin_versant* **sur** la cl√© *id_bassin* (cl√© √©trang√®re dans la table cours_eau).

## PostGIS

::: columns
::: {.column width="80%"}

- Extension de PostgreSQL qui permet de g√©rer des donn√©es g√©ographiques
- Surtout utilis√© pour les donn√©es vectorielles (points, lignes, polygones) :

:::
::: {.column width="20%"}

![](./img/postgis.png){width="100%"}

:::
:::

- [requ√™tes spatiales (ST_OVERLAPS, ST_CONTAINS, ST_WITHIN, ST_EQUALS)]{style="font-size: 0.9em;"}
- [calculs g√©om√©triques (ST_AREA, ST_LENGTH)]{style="font-size: 0.9em;"}
- [analyses spatiales (ST_BUFFER, ST_INTERSECTION, ST_UNION)]{style="font-size: 0.9em;"}
- [traitements de donn√©es (ST_TRANSFORM, ST_CENTROID)]{style="font-size: 0.9em;"}
- [cr√©er des index spatiaux (GIST)]{style="font-size: 0.9em;"}

## A vous de jouer !

Sur le site avec l'option PostgreSQL [SQLZoo](https://sqlzoo.net/) :

- [Basics](https://sqlzoo.net/wiki/SELECT_basics)
- [SELECT FROM WORLD](https://sqlzoo.net/wiki/SELECT_from_WORLD_Tutorial)
- [SELECT FROM NOBEL (facultatif)](https://sqlzoo.net/wiki/SELECT_from_Nobel_Tutorial)
- [SELECT IN SELECT (facultatif)](https://sqlzoo.net/wiki/SELECT_within_SELECT_Tutorial)
- [SUM and COUNT](https://sqlzoo.net/wiki/SUM_and_COUNT)
- [Les jointures](https://sqlzoo.net/wiki/The_JOIN_operation)

